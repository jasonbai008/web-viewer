# vue-preview

一个强大的 Web 预览工具，支持预览 Vue2 和 Vue3 单文件组件(SFC)、Html。

## Html 预览原理

本工具采用 `iframe` 预览，将用户代码通过 `iframe` 加载到浏览器中，并监听 `iframe` 的 `load` 事件，获取 `iframe` 内的 DOM 结构。

## 预览原理（Vue2）

本工具采用运行时编译和渲染技术，主要实现原理如下：

1. **解析用户代码**

   - 使用正则表达式解析单文件组件代码
   - 分别提取 template、script 和 style 部分
   - 通过 `parseCode` 方法将 SFC 代码分解为三个部分

2. **运行时编译**

   - 将 script 部分通过 `evalScript` 方法转换为组件配置对象
   - 使用 Function 构造函数动态执行脚本代码
   - 将提取的 template 添加到组件配置中

3. **动态渲染**

   - 创建唯一的挂载点 ID
   - 使用 `new Vue()` 实例化组件并挂载到 DOM
   - 支持实时更新和重新渲染

4. **样式处理**

   - 将提取的 style 内容动态添加到 document.head
   - 使用唯一 ID 防止样式冲突
   - 支持 scoped 样式隔离

5. **错误处理**
   - 捕获解析和渲染过程中的错误
   - 在界面中友好展示错误信息
   - 提供重置功能恢复到默认示例

## 预览原理（Vue3）

本工具使用 vue3-sfc-loader 实现 Vue3 组件的动态加载和预览：

1. **组件加载器配置**

   - 使用 `vue3-sfc-loader` 库处理单文件组件
   - 配置模块缓存，包含 Vue 和 Element Plus
   - 自定义文件加载和样式处理逻辑

2. **动态编译**

   - 通过 `loadModule` 方法加载组件代码
   - 自动处理组件依赖关系
   - 支持 setup 语法糖和组合式 API

3. **应用挂载**

   - 使用 `createApp` 创建 Vue3 应用实例
   - 全局注册 Element Plus 组件库
   - 将应用挂载到预览容器

4. **样式隔离**

   - 动态注入组件样式到 head
   - 处理 Element Plus 的组件级样式
   - 确保样式作用域不冲突

5. **错误处理**
   - 完整的错误捕获和提示
   - 支持开发时的调试信息
   - 友好的错误信息展示
